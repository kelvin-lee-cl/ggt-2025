<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Girls Go Tech AI Application - Learning Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/fa/css/all.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
</head>

<body>
    <!-- Shared Navbar -->
    <div id="navbar-root"></div>

    <!-- Login Gate (shown when not authenticated) -->
    <section id="loginGate" class="py-5 mt-5" style="display: none;">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="card shadow-sm">
                        <div class="card-body text-center p-4">
                            <h3 class="mb-3" data-en="Welcome to Girl Go Tech AI Application"
                                data-zh-tw="歡迎來到 Girl Go Tech AI Application"
                                data-zh-cn="歡迎來到 Girl Go Tech AI Application">Welcome to Girl Go Tech AI Application
                            </h3>
                            <p class="text-muted mb-4" data-en="Please log in to continue." data-zh-tw="請先登入以繼續。"
                                data-zh-cn="請先登入以繼續。">Please log in to continue.</p>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- App Content (hidden until authenticated) -->
    <div id="appContent" style="display: none;">


        <!-- Lessons Section -->
        <section id="lessons" class="py-5">
            <div class="container">
                <h2 class="text-center mt-5 mb-5" data-en="Available Lessons" data-zh-tw="可用課程" data-zh-cn="可用课程">
                    Available
                    Lessons</h2>
                <div class="row" id="lessonsContainer">
                    <!-- Lessons will be loaded dynamically here -->
                </div>
            </div>
        </section>

        <!-- AI Tools Section -->
        <section id="tools" class="py-5 bg-light">
            <div class="container">
                <h2 class="text-center mb-5 mt-5" data-en="AI-Powered Learning Tools" data-zh-tw="AI驅動的學習工具"
                    data-zh-cn="AI驱动的学习工具">AI-Powered
                    Learning
                    Tools</h2>
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <div class="card h-100 tool-card">
                            <div class="card-body text-center">
                                <i class="fas fa-image fa-3x text-primary mb-3"></i>
                                <h5 class="card-title" data-en="Image Generator" data-zh-tw="圖像生成器" data-zh-cn="图像生成器">
                                    Image
                                    Generator</h5>
                                <p class="card-text"
                                    data-en="Create custom images using AI to visualize your ideas and concepts."
                                    data-zh-tw="使用AI創建自定義圖像來可視化您的想法和概念。" data-zh-cn="使用AI创建自定义图像来可视化您的想法和概念。">Create
                                    custom
                                    images using AI to visualize your ideas
                                    and concepts.</p>
                                <a href="image-generator.html" class="btn btn-primary" data-en="Generate Images"
                                    data-zh-tw="生成圖像" data-zh-cn="生成图像">Generate Images</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card h-100 tool-card">
                            <div class="card-body text-center">
                                <i class="fas fa-edit fa-3x text-primary mb-3"></i>
                                <h5 class="card-title" data-en="Text Generator" data-zh-tw="文本生成器" data-zh-cn="文本生成器">
                                    Text
                                    Generator</h5>
                                <p class="card-text"
                                    data-en="Generate essays, summaries, and creative content with AI assistance."
                                    data-zh-tw="使用AI輔助生成文章、摘要和創意內容。" data-zh-cn="使用AI辅助生成文章、摘要和创意内容。">
                                </p>
                                <a href="text-generator.html" class="btn btn-primary" data-en="Generate Text"
                                    data-zh-tw="生成文本" data-zh-cn="生成文本">Generate Text</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Classwork Section -->
        <section id="classwork" class="py-5">
            <div class="container">
                <h2 class="text-center mb-5" data-en="Submit Your Milestone Projects" data-zh-tw="提交您的里程碑項目"
                    data-zh-cn="提交您的里程碑项目">Submit Your
                    Milestone Projects</h2>
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-upload fa-3x text-success mb-3"></i>
                                <h5 class="card-title" data-en="Upload Assignments" data-zh-tw="上傳作業" data-zh-cn="上传作业">
                                    Upload Assignments</h5>
                                <p class="card-text" data-en="Submit your completed assignments and projects."
                                    data-zh-tw="提交您完成的作業和項目。" data-zh-cn="提交您完成的作业和项目。">Submit your completed
                                    assignments
                                    and projects.</p>
                                <a href="upload.html" class="btn btn-success" data-en="Upload Work" data-zh-tw="上傳作業"
                                    data-zh-cn="上传作业">Upload
                                    Work</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-question-circle fa-3x text-info mb-3"></i>
                                <h5 class="card-title" data-en="Q&A Assessment" data-zh-tw="問答評估" data-zh-cn="问答评估">Q&A
                                    Assessment</h5>
                                <p class="card-text" data-en="Test your understanding with interactive quizzes."
                                    data-zh-tw="通過互動測驗測試您的理解。" data-zh-cn="通过互动测验测试您的理解。">Test your understanding with
                                    interactive quizzes.</p>
                                <a href="quiz.html" class="btn btn-info" data-en="Take Quiz" data-zh-tw="參加測驗"
                                    data-zh-cn="参加测验">Take Quiz</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="bg-dark text-white py-4">
            <div class="container">
                <div class="row">
                    <div class="col-md-6">
                        <h5 data-en="Girls Go Tech AI Application" data-zh-tw="Girls Go Tech AI Application"
                            data-zh-cn="Girls Go Tech AI Application">Girls Go
                            Tech AI Application</h5>
                        <p data-en="Empowering students with interactive learning tools and AI assistance."
                            data-zh-tw="通過互動學習工具和AI輔助賦能學生。" data-zh-cn="通过互动学习工具和AI辅助赋能学生。">Empowering students with
                            interactive learning tools and AI
                            assistance.</p>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <p data-en="&copy; 2024 Girls Go Tech AI Application. All rights reserved."
                            data-zh-tw="&copy; 2024 Girls Go Tech AI Application. All rights reserved."
                            data-zh-cn="&copy; 2024 Girls Go Tech AI Application. All rights reserved.">
                            &copy; 2024 Girls Go Tech AI Application. All rights reserved.</p>
                    </div>
                </div>
            </div>
        </footer>

    </div>

    <!-- Netlify Identity Widget -->
    <div id="netlify-identity-widget"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Netlify Identity removed: using Firebase Auth only -->
    <!-- Firebase SDK for Google login (must load BEFORE script.js) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="navbar.js"></script>
    <script src="script.js"></script>
    <script>
        // Localhost: enable Google sign-in using Firebase Auth
        (function () {
            const isLocalhost = window.location.hostname === 'localhost' ||
                window.location.hostname === '127.0.0.1' ||
                window.location.hostname === '0.0.0.0' ||
                window.location.hostname.includes('localhost');

            if (!isLocalhost) return;

            try {
                if (!firebase.apps?.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                const auth = firebase.auth();
                const provider = new firebase.auth.GoogleAuthProvider();

                const gateBtn = document.getElementById('loginGateLoginBtn');
                if (gateBtn) {
                    gateBtn.addEventListener('click', async function (e) {
                        e.preventDefault();
                        try {
                            const result = await auth.signInWithPopup(provider);
                            // Create a Netlify-Identity-like user object for UI reuse
                            window.currentUser = {
                                id: result.user.uid,
                                email: result.user.email,
                                user_metadata: { full_name: result.user.displayName }
                            };
                            // Notify existing UI to update
                            if (typeof updateAuthUI === 'function') {
                                // Also set global currentUser used by script.js
                                if (typeof window !== 'undefined') {
                                    window.currentUser = window.currentUser;
                                }
                                // Force UI refresh
                                updateAuthUI();
                            }
                        } catch (err) {
                            console.error('Google sign-in failed:', err);
                            if (typeof showAlert === 'function') {
                                showAlert('Google sign-in failed. Please try again.', 'danger');
                            }
                        }
                    });
                }
            } catch (e) {
                console.warn('Firebase local auth init skipped:', e);
            }
        })();
    </script>
    <script>
        // Load and display all lessons dynamically
        async function loadLessons() {
            try {
                const response = await fetch('lessons.json');
                const data = await response.json();
                const lessonsContainer = document.getElementById('lessonsContainer');

                let lessonsHTML = '';

                data.lessons.forEach(lesson => {
                    const lessonId = lesson.id;
                    const isDefaultNotStarted = (lessonId === 'lesson1' || lessonId === 'lesson2');

                    // default per-user: lesson1/lesson2 Not Started (0%)
                    const baseStatus = isDefaultNotStarted ? 'not-started' : (lesson.status || 'not-started');
                    const baseStatusText = isDefaultNotStarted ? 'Not Started (0%)' : (lesson.statusText || 'Not Started');
                    const statusClass = getStatusClass(baseStatus);
                    const statusIcon = getStatusIcon(baseStatus);

                    lessonsHTML += `
                        <div class="col-md-4 mb-4">
                            <div class="card h-100 lesson-card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <h5 class="card-title">${lesson.title}</h5>
                                        <span class="badge ${statusClass}" id="statusBadge-${lessonId}">${statusIcon}</span>
                                    </div>
                                    <p class="card-text">${lesson.subtitle}</p>
                                    <small class="text-muted" id="statusText-${lessonId}">${baseStatusText}</small>
                                    <div class="mt-3">
                                        <a href="lesson.html?lesson=${lesson.id}" class="btn btn-primary">
                                            <i class="fas fa-play me-2"></i>
                                            View Lesson
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });

                lessonsContainer.innerHTML = lessonsHTML;
                // After rendering, try to overlay per-user statuses from Firebase
                setTimeout(updateUserLessonStatuses, 300);
                setTimeout(updateUserLessonStatuses, 2000);
            } catch (error) {
                console.error('Error loading lessons:', error);
                document.getElementById('lessonsContainer').innerHTML =
                    '<div class="col-12"><div class="alert alert-danger">Error loading lessons. Please try again later.</div></div>';
            }
        }

        // Get status class for badge
        function getStatusClass(status) {
            switch (status) {
                case 'completed': return 'bg-success';
                case 'in-progress': return 'bg-warning';
                default: return 'bg-secondary';
            }
        }

        // Get status icon
        function getStatusIcon(status) {
            switch (status) {
                case 'completed': return '✓';
                case 'in-progress': return '⏳';
                default: return '○';
            }
        }

        // Get status badge class
        function getStatusBadgeClass(status) {
            switch (status) {
                case 'completed': return 'bg-success';
                case 'in-progress': return 'bg-warning';
                default: return 'bg-secondary';
            }
        }

        // Load lessons when page loads
        document.addEventListener('DOMContentLoaded', loadLessons);

        // Overlay per-user status from Firestore
        async function updateUserLessonStatuses() {
            try {
                if (!window.firebaseDb || !window.firebaseAuth) return;
                const auth = window.firebaseAuth;
                const db = window.firebaseDb;
                const user = auth.currentUser;
                if (!user) return;
                const snap = await db.collection('userProgress').doc(user.uid).get();
                if (!snap.exists) return;
                const lessons = (snap.data() && snap.data().lessons) || {};
                Object.keys(lessons).forEach(lessonId => {
                    const info = lessons[lessonId] || {};
                    // Rule: Exercise submission counts as completed
                    const status = (info.status === 'completed' || (info.exercise && info.exercise.submitted)) ? 'completed' : 'not-started';
                    const text = status === 'completed' ? 'Completed' : 'Not Started';
                    const badgeEl = document.getElementById(`statusBadge-${lessonId}`);
                    const textEl = document.getElementById(`statusText-${lessonId}`);
                    if (badgeEl) {
                        badgeEl.className = `badge ${getStatusClass(status)}`;
                        badgeEl.textContent = getStatusIcon(status);
                    }
                    if (textEl) {
                        textEl.textContent = text;
                    }
                });
            } catch (e) {
                // non-fatal
            }
        }
    </script>
</body>

</html>